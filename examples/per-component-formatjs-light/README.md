# Упрощенный formatjs (по-компонентный)

**Особенности**

- Сохранен привычный синтаксис вызова примерно как в `@gravity-ui/i18n`
- Улучшается DX так как тексты хранятся рядом с компонентами. Также не нужно придумывать ключи для танкера (это сделает автоматика)
- Флоу работы с переводами (Танкер) не меняется совсем
- Можно использовать и без взаимодействия с Танкером (а если потребуется использовать танкер, то можно легко мигрировать структуру)
- Разработчик может видеть как выглядит интерфейс на любом языке

**Что придется доделывать:**

- Адаптировать генерацию id к сообщениям, определенным через `intl.createMessages`. Нужно доработать eslint-плагин от фантеха.
- Адаптировать существующий (от formatjs) или написать свой babel-плагин для компиляции сообщений из `intl.createMessages` в AST.
- Webpack-плагин для инлайна ключей (мб и не понадобится большинству сервисов)

## Флоу работы

![flow](./flow.png =800x)

## Как поставлять тексты

В development доступны все языки.
В production доставляются все языки вместе с компонентом, в котором они используются. Если вас устраивает такой вариант, то дополнительно можно ничего не настраивать.

Но если вы хотите поставлять тексты только для определенного языка в production, то вы можете только воспользоваться инлайном через webpack-плагин.

### Inline (webpack)

Доработаем существующий webpack-плагин, который будет генерировать локализованные ассеты под определенные локали (просто будет подставлять сообщение в defaultMessage).

Пример как преобразуется модуль под EN-локаль:

```diff
import { commonMessages, intl } from "@shared/i18n";

import { intl } from "@shared/i18n";

export const messages = intl.createMessages({
    pageTitle: {
-       ru: 'О нас',
        en: 'About us',
    },
    countOffices: {
-       ru: `{countOffices, plural,
-           =0 {У нас нет офисов}
-           =1 {У нас всего один офис}
-           other {У нас # офисов}
-       }`,
        en: `{countOffices, plural,
            =0 {We don't have offices}
            =1 {We have only one office}
            other {We have # offices}
        }`,
    }
});
```
