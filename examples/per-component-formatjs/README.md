# Особенности

- Тексты всех языков описываются в коде
- id сообщения генерируется автоматически только один раз для каждого сообщения и остается неизменным! Генерация происходит при помощи eslint-плагина.

**Плюсы:**

- Улучшается DX так как тексты можно описывать в коде и не лезть в json-ы. Также не нужно придумывать ключи.
- Флоу работы с переводами (Танкер) не меняется совсем
- Можно использовать и без взаимодействия с Танкером
- Разработчик сможет увидеть как выглядит интерфейс на второстепенном языке

**Минусы:**

- Изменения текста второстепенного языка всегда осуществляются через Танкер и затем должны вливаться в trunk
- Может быть неудобно пользоваться синтаксисом `<FormattedMessage {...messages.custom} />`
- Запрещается использование синтаксиса вида `intl.formatMessage({id: 'somemessage.id', defaultMessage: 'message'})`
- Пропадает валидация передачи всех необходмых параметров в `defaultMessage`

**Что придется доделывать:**

- Адаптировать генерацию id к сообщениям, определенным через `intl.createMessages`. Нужно доработать eslint-плагин от фантеха.
- Адаптировать существующий (от formatjs) или написать свой babel-плагин для компиляции сообщений из `intl.createMessages` в AST.
- i18n-sync должен научиться парсить и раскладывать тексты из файлов вида `intl.createMessages`. Это недорого так как в либе уже поддерживаются кастомные форматы.
- i18n-sync должен научиться валидировать совпадения ключей в различных файлах (так как от экстрактинга formatjs/cli придется отказаться в таком флоу)
- Webpack-плагин для инлайна ключей (мб и не понадобится большинству сервисов)

## Флоу работы

![flow](./flow.png =800x)

## Как поставлять тексты

В development доступны все языки.
В production доставляются все языки вместе с компонентом, в котором они используются. Если вас устраивает такой вариант, то дополнительно можно ничего не настраивать.

Но если вы хотите поставлять тексты только для определенного языка в production, то вы можете только воспользоваться инлайном через webpack-плагин.

### Inline (webpack)

Доработаем существующий webpack-плагин, который будет генерировать локализованные ассеты под определенные локали (просто будет подставлять сообщение в defaultMessage).

Пример как преобразуется модуль под EN-локаль:

```diff
import { commonMessages, intl } from "@shared/i18n";

import { intl } from "@shared/i18n";

export const messages = intl.createMessages({
    pageTitle: {
        id: 'pages.AboutPage.984hgs',
-        description: 'Тайтл страницы о нас',
        messages: {
-            ru: 'О нас',
            en: 'About us',
        },
    },
    countOffices: {
        id: 'pages.AboutPage.098fg2',
-        description: 'Количество офисов в стране',
        messages: {
-            ru: `{countOffices, plural,
-                =0 {У нас нет офисов}
-                =1 {У нас всего один офис}
-                other {У нас # офисов}
-            }`,
            en: `{countOffices, plural,
                =0 {We don't have offices}
                =1 {We have only one office}
                other {We have # offices}
            }`,
        },
    }
});
```
