# Product Context

This file provides a high-level overview of the project and the expected product that will be created. Initially it is based upon projectBrief.md (if provided) and all other available project-related information in the working directory. This file is intended to be updated as the project evolves, and should be used to inform all other modes of the project's goals and context.
2025-04-23 15:48:00 - Log of updates made will be appended as footnotes to the end of this file.

## Проект i18n инструментов DATAUI

Репозиторий содержит набор инструментов и библиотек для интернационализации (i18n) в проектах DATAUI. Эти инструменты предназначены для упрощения работы с многоязычными текстами, их хранения, оптимизации и синхронизации с системой переводов Танкер.

## Project Goal

Основная цель проекта - предоставить разработчикам DATAUI удобные и эффективные инструменты для работы с многоязычными текстами. Проект решает следующие задачи:

1. Упрощение работы с переводами в React и Node.js приложениях
2. Оптимизация доставки языковых файлов
3. Синхронизация переводов с системой Танкер
4. Обеспечение линтинга для правильного использования i18n
5. Поддержка миграции с устаревших систем i18n на новую

## Key Features

1. **Компонентный подход к хранению текстов** - каждый компонент имеет свой i18n файл с переводами
2. **Поддержка ICU Message Format** - для сложного форматирования текстов
3. **Поддержка Rich Text и Markdown** - для форматированных текстов
4. **Система фолбэков** - для отсутствующих переводов
5. **Оптимизация доставки языковых файлов** - через Babel и Webpack/Rspack плагины
6. **Инструменты миграции** - для перехода с устаревших систем i18n
7. **Интеграция с Танкером** - для синхронизации переводов

## Overall Architecture

Проект организован как монорепозиторий с несколькими пакетами:

1. **i18n-core** - Корневая библиотека i18n, обвязка над FormatJS
   - Предоставляет базовые функции для работы с переводами
   - Экспортирует фабричные функции для создания функций работы с сообщениями
   - Управляет фолбэками для отсутствующих переводов
   - Обеспечивает кэширование для оптимизации производительности

2. **i18n-react** - Библиотека i18n для клиентских приложений на React
   - Расширяет i18n-core для работы с React
   - Предоставляет компонент Message для отображения переводов
   - Поддерживает Rich Text с React-компонентами
   - Интегрируется с react-intl

3. **i18n-node** - Библиотека i18n для серверных приложений
   - Адаптирует i18n-core для использования в Node.js
   - Поддерживает работу с разными локалями в одном экземпляре приложения
   - Оптимизирована для серверного рендеринга

4. **eslint-plugin-i18n** - Правила линтинга eslint
   - Проверяет правильность использования i18n в коде
   - Предотвращает типичные ошибки при работе с переводами
   - Включает следующие правила:
     * **restrict-i18n-imports** - Запрещает импорт файлов с текстами (`i18n.ts`) из директорий других уровней
     * **auto-generate-translation-message-id** - Проверяет наличие идентификатора в объекте перевода и добавляет его при отсутствии
     * **detect-incorrect-calls** - Проверяет корректность вызовов i18n функций (использование строковых литералов для ключей, правильное количество аргументов)
     * **string-literal-keys** - Проверяет, что ключи в вызовах i18n функций являются строковыми литералами

5. **i18n-cli** - Инструмент для операций над языковыми файлами
   - Предоставляет конфигурацию i18n для проекта через файл i18n.config.ts
   - Команда `create-keys` - проверяет вызовы i18n-функций и добавляет отсутствующие ключи в файл i18n.ts
   - Команда `find-unused` - находит и опционально удаляет неиспользуемые ключи переводов
   - Поддерживает работу с клиентской и серверной частями приложения
   - Предоставляет API для парсинга и генерации файлов с переводами
   - Интегрируется с VS Code через расширение для удобного создания ключей

6. **i18n-babel-plugin** - Babel-плагин для оптимизации поставки языковых файлов
   - Удаляет meta-информацию из сообщений (id, description и т.д.)
   - Преобразует Markdown в HTML (при meta.markdown === true)
   - Применяет типограф к содержимому ключей
   - Минифицирует ICU MessageFormat сообщения
   - Поддерживает режим "только переводы" для оптимизации бандла
   - Поддерживает компиляцию сообщений в AST для улучшения производительности
   - Оптимизирует сборку для уменьшения размера бандла
   - Извлекает статические строки для перевода

7. **i18n-optimize-plugin** - Webpack/Rspack плагин для оптимизации поставки языковых файлов
   - Оптимизирует загрузку языковых файлов
   - Поддерживает разделение кода по языкам

8. **i18n-sync** - Инструмент для синхронизации переводов проекта с Танкером
   - Синхронизирует переводы между проектом и системой переводов Танкер
   - Управляет статусами переводов
   - Предоставляет CLI-команды для работы с переводами:
     * `pull` - скачивает переводы из Танкера
     * `push` - отправляет изменения в Танкер
     * `branch` - работает с ветками переводов
     * `create` - создает новые кейсеты и ключи
     * `diff` - показывает разницу между переводами в разных ветках
     * `stat` - анализирует состояние переводов
     * `clean` - удаляет устаревшие ветки
   - Поддерживает работу с ветками переводов, аналогично Git/Arc
   - Автоматически создает тикеты на перевод в Трекере
   - Хранит переводы в структурированном формате JSON
   - Поддерживает кастомное расположение директорий с кейсетами
   - Интегрируется с FormatJS через специальный загрузчик:
     * Поддерживает формат переводов FormatJS (ICU Message Format)
     * Обеспечивает совместимость с React-компонентами FormatJS
     * Сохраняет метаданные переводов (id, description, markdown)
     * Обрабатывает плюральные формы между различными локалями

Архитектура системы построена на принципе разделения ответственности:
- **i18n-core** предоставляет базовый функционал
- **i18n-react** и **i18n-node** адаптируют этот функционал для конкретных сред выполнения
- Инструменты сборки и оптимизации обеспечивают эффективную доставку переводов
- Инструменты синхронизации и CLI обеспечивают управление переводами

Также в репозитории есть демонстрационный проект, показывающий использование этих инструментов, и скрипты миграции для перехода с устаревших систем i18n.

---

2025-04-23 15:48:00 - Первоначальное создание файла на основе анализа репозитория.